\documentclass[a4paper,12pt]{article}
\usepackage{amsmath,amssymb}
\usepackage{tikz}
\usepackage{fullpage}
\usepackage{bm}
\usepackage{float}
\usetikzlibrary{bayesnet}
\DeclareMathOperator{\E}{\mathbb{E}}

\begin{document}
\begin{align*}
    y \mid x &\sim \left(1 - q_y\right)\cdot\text{Gamma}\left(\mu\beta, \beta\right) + q_y \cdot \text{HalfNormal}\left(\sigma_{\text{outlier}}\right) \tag{4.2.5} \\
    q_y &\sim \text{Bernoulli}\left(p_{\text{outlier}}\right) \tag{4.2.6} \\
    p_{\text{outlier}} &\sim \text{Uniform}\left(0, C_{p_{\text{outlier}}}\right) \tag{4.2.7} \\
    \sigma_{\text{outlier}} &\sim \text{HalfNormal}\left(C_{\sigma_{\text{outlier}}}\right) \tag{4.2.8}
    % &y \mid x, \Omega \sim \left(1 - \mathrm{Bern}\left(p_{\text{outlier}}\right)\right)\cdot\mathcal{G}\left(\mu\beta, \beta\right) + \mathrm{Bern}\left(p_{\text{outlier}}\right) \cdot \mathcal{HN}\left(\sigma_{\text{outlier}}\right) \tag{4.2.2} \\
\end{align*}

where $C_{p_{\text{outlier}}}, C_{\sigma_{\text{outlier}}} > 0$ are constants and $C_{p_{\text{outlier}}} < 1$ is chosen to be small, usually in the range $0.01 - 0.02$. Intuitively, this means we expect there to be roughly $1\% - 2\%$ outliers which will be captured by the HalfNormal distribution.

\begin{figure}[H]
    \centering
    \tikz{ %
        % Obs
        \node[obs,fill,] (obs) {${y}$};%

        % Deterministic mu, beta
        \node[det,above=of obs,xshift=-1.2cm,yshift=-.5cm,fill,] (beta) {${\beta}$}; %
        \node[det,above=of obs,xshift=1.2cm,yshift=.2cm,fill,] (mu) {${\mu}$}; %
        \node[obs,above=of obs,xshift=-.8cm,yshift=1.5cm,fill,] (intensity) {${x}$};%
        \node[latent,left=of obs,xshift=0cm,yshift=.5cm,fill] (binary_obs) {$q_y$};%
        \plate[inner sep=.1cm, yshift=.07cm] {plate_obs} {(obs)(mu)(beta)(intensity)} {$\text{intensity }i: 1, 2 \ldots n(p)$};

        % Outlier distribution
        \node[latent,left=of intensity,xshift=-2cm,yshift=-1cm,fill] (p_outlier) {$p_{\text{outlier}}$};
        \node[latent,above=of p_outlier,xshift=0cm,yshift=-.8cm,fill] (outlier_scale) {$\sigma_{\text{outlier}}$};

        % % PRIORS
        % a, b, v
        \node[latent,above=of obs,yshift=3cm,xshift=-1cm,fill,] (a) {$a$};
        \node[latent,right=of a,xshift=-.3cm,fill,] (b) {$b$};
        % \node[latent,right=of b,xshift=-.9cm,fill,] (v) {$v^{p}$};
        % L, ell, H
        \node[latent,right=of b,xshift=-.9cm,fill,] (L) {$L$};
        \node[latent,right=of L,xshift=-.9cm,fill,] (ell) {$\ell$};
        \node[latent,right=of ell,xshift=-.9cm,fill,] (H) {$H$};
        % g1, g2
        \node[latent,left=of a,xshift=.3cm,fill,] (g2) {${c_2}$};
        \node[latent,left=of g2,xshift=.9cm,fill,] (g1) {${c_1}$};

        % Participants plate
        \plate[inner sep=.1cm, yshift=.07cm] {plate_participant} {(a)(b)(L)(H)(ell)(g1)(g2)(plate_obs)} {$\text{participant }p : 1, 2 \ldots N_P$};

        % % HYPER-PRIORS
        \node[latent,above=of a,xshift=-.43cm,fill,] (a_mean) {${\mu_a}$};
        \node[latent,above=of a,xshift=.43cm,fill,] (a_scale) {${\sigma_a}$};
        \node[latent,above=of b,fill] (b_scale) {${\sigma_b}$};
        \node[latent,above=of g2,fill] (g2_scale) {${\sigma_{c_2}}$};
        \node[latent,above=of g1,fill,] (g1_scale) {${\sigma_{c_1}}$};
        \node[latent,above=of L,fill,] (L_scale) {${\sigma_L}$};
        \node[latent,above=of H,fill,] (H_scale) {${\sigma_H}$};
        % \node[latent,above=of v,fill,] (v_scale) {${\sigma_v}$};
        \node[latent,above=of ell,fill,] (ell_scale) {${\sigma_\ell}$};

        % Edges from Hyper-priors to Priors
        \edge {g1_scale} {g1}
        \edge {g2_scale} {g2}
        \edge {a_mean, a_scale} {a}
        \edge {b_scale} {b}
        \edge {L_scale} {L}
        \edge {H_scale} {H}
        % \edge {v_scale} {v}
        \edge {ell_scale} {ell}

        % Edges from Priors to Deterministic
        \edge {g1, g2} {beta}
        \edge {a, b, L, ell, H} {mu}

        % Edges to obs
        \edge {intensity} {beta, mu}
        \edge{p_outlier} {binary_obs}
        \edge {beta,mu,binary_obs,outlier_scale} {obs};
        \edge {mu} {beta};
        \plate[inner sep=.1cm, yshift=.07cm] {plate_muscle} {(a_mean)(a_scale)(b_scale)(L_scale)(ell_scale)(H_scale)(plate_participant)} {$\text{muscle }m : 1, 2 \ldots N_M$};
    }
\end{figure}

\end{document}
