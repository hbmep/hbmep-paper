\documentclass[a4paper,12pt]{article}
\usepackage{amsmath,amssymb}
\usepackage{tikz}
\usepackage{fullpage}
\usepackage{bm}
\usepackage{float}
\usetikzlibrary{bayesnet}
\DeclareMathOperator{\E}{\mathbb{E}}

\begin{document}

Itâ€™s often the case that there is some group structure present within participants. The default model can then be extended to exploit such structure which allows for direct comparison of group parameters. We introduce partial-pooling of group parameters by placing a group-specific prior on each parameter. The group-specific priors are then informed by global priors which are shared between groups. The global priors are informed by hyperpriors, which are shared between all groups and chosen to be weakly informative. \\

Fig. 4.3.2 shows the graphical representation of group model implemented by hbmep. In section 5.2, we use this model $($with $N_G = 2$$)$ to directly compare the group threshold parameters $\mu_a$ of uninjured and injured participants.

\begin{figure}[H]
    \centering
    \tikz{ %
        % Obs
        \node[obs,fill] (obs) {$y$};%

        % Deterministic mu, beta
        \node[det,above=of obs,xshift=-.8cm,fill] (beta) {$\beta$}; %
        \node[det,above=of obs,xshift=.8cm,yshift=.5cm,fill] (mu) {$\mu$}; %
        \plate[inner sep=.25cm, yshift=.2cm] {plate_obs} {(obs)(mu)(beta)} {$1, 2 \ldots n(p, h)$};

        % % PRIORS
        % a, b, v
        \node[det,above=of obs,yshift=2.8cm,xshift=-1.3cm,fill] (a) {$a$};
        \node[latent,right=of a,xshift=-.9cm,fill] (b) {$b$};
        \node[latent,right=of b,xshift=-.9cm,fill] (v) {$v$};
        % L, H, v, ell
        \node[latent,right=of v,xshift=-.9cm,fill] (L) {$L$};
        \node[latent,right=of L,xshift=-.9cm,fill] (ell) {$\ell$};
        \node[latent,right=of ell,xshift=-.9cm,fill] (H) {$H$};
        % g1, g2
        \node[latent,left=of a,xshift=.9cm,fill] (g2) {${g_2}$};
        \node[latent,left=of g2,xshift=.9cm,fill] (g1) {${g_1}$};

        % Participants plate
        \plate[inner sep=.25cm, yshift=.2cm] {plate_participant} {(a)(b)(L)(H)(v)(ell)(g1)(g2)(plate_obs)} {$p:1, 2 \ldots N_P$};

        % % HYPER-PRIORS
        \node[latent,above=of b,fill] (b_scale) {$\sigma_b$};
        % g1_scale, g2_scale, L_scale, H_scale, v_scale, ell_scale
        \node[latent,above=of g2,fill] (g2_scale) {$\sigma_{g_2}$};
        \node[latent,above=of g1,fill] (g1_scale) {$\sigma_{g_1}$};
        \node[latent,above=of L,fill] (L_scale) {$\sigma_L$};
        \node[latent,above=of H,fill] (H_scale) {$\sigma_H$};
        \node[latent,above=of v,fill] (v_scale) {$\sigma_v$};
        \node[latent,above=of ell,fill] (ell_scale) {$\sigma_\ell$};

        % Groups plate
        \plate[inner sep=.25cm, yshift=.2cm] {plate_group} {(b_scale)(g1_scale)(g2_scale)(L_scale)(H_scale)(v_scale)(ell_scale)(plate_participant)} {$h: 1, 2 \ldots N_H$};

        % GLOBAL PRIORS
        \node[latent,above=of g2_scale,xshift=.05cm,fill] (g2_scale_global_scale) {$\sigma_{\sigma_{g_1}}$};
        \node[latent,above=of g1_scale,xshift=-.05cm,fill] (g1_scale_global_scale) {$\sigma_{\sigma_{g_2}}$};
        \node[latent,above=of b_scale,fill] (b_scale_global_scale) {$\sigma_{\sigma_{b}}$};
        \node[latent,above=of L_scale,fill] (L_scale_global_scale) {$\sigma_{\sigma_L}$};
        \node[latent,above=of H_scale,fill] (H_scale_global_scale) {$\sigma_{\sigma_H}$};
        \node[latent,above=of v_scale,fill] (v_scale_global_scale) {$\sigma_{\sigma_v}$};
        \node[latent,above=of ell_scale,fill] (ell_scale_global_scale) {$\sigma_{\sigma_\ell}$};

        % Edges from Global-priors to Priors
        \edge {g1_scale_global_scale} {g1_scale}
        \edge {g2_scale_global_scale} {g2_scale}
        \edge {b_scale_global_scale} {b_scale}
        \edge {L_scale_global_scale} {L_scale}
        \edge {H_scale_global_scale} {H_scale}
        \edge {v_scale_global_scale} {v_scale}
        \edge {ell_scale_global_scale} {ell_scale}

        % Edges from Hyper-priors to Priors
        \edge {g1_scale} {g1}
        \edge {g2_scale} {g2}
        \edge {b_scale} {b}
        \edge {L_scale} {L}
        \edge {H_scale} {H}
        \edge {v_scale} {v}
        \edge {ell_scale} {ell}

        % Edges from Priors to Deterministic
        \edge {g1, g2} {beta}
        \edge {a, b, v, L, ell, H} {mu}

        % Edges to obs
        \edge {beta,mu} {obs};
        \edge {mu} {beta};

        % Fixed
        \node[latent,left=of a,xshift=-3cm,yshift=.8cm,fill] (a_fixed) {$a_{\text{fixed}}$};
        \node[latent,above=of a_fixed,xshift=-.6cm,yshift=-.5cm,fill] (a_fixed_mean) {$\mu_{a_{\text{fixed}}}$};
        \node[latent,above=of a_fixed,xshift=.6cm,yshift=-.5cm,fill] (a_fixed_scale) {$\sigma_{a_{\text{fixed}}}$};
        % \plate[inner sep=.1cm, yshift=.0cm] {plate_participant_fixed} {(a_fixed)} {$p: 1, 2 \ldots N_P$};
        % \plate[inner sep=.1cm, yshift=.0cm] {plate_group_fixed} {(a_fixed_mean)(a_fixed_scale)(plate_participant_fixed)} {$h: 1$};
        \tikzset{plate caption/.style={caption, node distance=0, inner sep=0cm,
        below left=0cm and -1cm of #1.south,text height=1.2em,text depth=0.3em}}
        \plate {plate_participant_fixed} {(a_fixed)} {$p: 1, 2 \ldots N_P$};
        \tikzset{plate caption/.style={caption, node distance=0, inner sep=-.1cm,
        below left=0cm and -1cm of #1.south,text height=1.2em,text depth=0.3em}}
        \plate {plate_group_fixed} {(a_fixed_mean)(a_fixed_scale)(plate_participant_fixed)} {$h: 1$};

        % Random
        \node[latent,below=of a_fixed,yshift=-3cm,fill] (a_random) {$a_{\text{random}}$};
        \node[latent,above=of a_random,xshift=-.7cm,yshift=-.5cm,fill] (a_random_mean) {$\mu_{a_{\text{random}}}$};
        \node[latent,above=of a_random,xshift=.7cm,yshift=-.5cm,fill] (a_random_scale) {$\sigma_{a_{\text{random}}}$};
        \tikzset{plate caption/.style={caption, node distance=0, inner sep=0cm,
        below left=0cm and -1cm of #1.south,text height=1.2em,text depth=0.3em}}
        \plate {plate_participant_random} {(a_random)} {$p: 1, 2 \ldots N_P$};
        \tikzset{plate caption/.style={caption, node distance=0, inner sep=-.1cm,
        below left=0cm and -1.2cm of #1.south,text height=1.2em,text depth=0.3em}}
        \plate {plate_group_random} {(a_random_mean)(a_random_scale)(plate_participant_random)} {$h: 2, 3 \ldots N_H$};

        % Edges from a_fixed and a_random to deterministic a
        \edge {a_fixed, a_random} {a}
    }
\end{figure}

Although the group threshold parameters $\mu_a$ and $\sigma_a$ are assumed to be generated from a common population, we consciously avoid pooling these parameters. The reason for doing so is two folds. Firstly, often there is enough information available to directly specify these parameters. Secondly, we expect these parameters to be different between groups. For instance, the thresholds are the most likely to be affected by injury.

\end{document}
